# ğŸš› ë°±ì‹  ìš´ì†¡ ì°¨ëŸ‰ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ íŠ¸ëŸ­ì˜ GPS ìœ„ì¹˜ì™€ ëƒ‰ì¥ê³  ì˜¨ë„ë¥¼ ìˆ˜ì§‘í•˜ê³ , ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ë©° MQTTë¡œ ì „ì†¡í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨
- [ì£¼ìš” ê¸°ëŠ¥](#ì£¼ìš”-ê¸°ëŠ¥)
- [ì‹œìŠ¤í…œ êµ¬ì¡°](#ì‹œìŠ¤í…œ-êµ¬ì¡°)
- [ì„¤ì¹˜ ë°©ë²•](#ì„¤ì¹˜-ë°©ë²•)
- [ì‚¬ìš© ë°©ë²•](#ì‚¬ìš©-ë°©ë²•)
- [ì›¹ ëŒ€ì‹œë³´ë“œ](#ì›¹-ëŒ€ì‹œë³´ë“œ)
- [ì½”ë“œ êµ¬ì¡° ìƒì„¸ ì„¤ëª…](#ì½”ë“œ-êµ¬ì¡°-ìƒì„¸-ì„¤ëª…)
- [ë°ì´í„°ë² ì´ìŠ¤](#ë°ì´í„°ë² ì´ìŠ¤)
- [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)

---

## ì£¼ìš” ê¸°ëŠ¥

### âœ… ì‹¤ì‹œê°„ GPS + ì˜¨ë„ ë°ì´í„° ìˆ˜ì§‘/ì „ì†¡
- **GPS ë°ì´í„°**: ìœ„ë„, ê²½ë„, ê³ ë„, ì†ë„, ë°©í–¥
- **ì˜¨ë„ ë°ì´í„°**: MCP9600 ì„¼ì„œ ë˜ëŠ” ì‹œë®¬ë ˆì´í„° (ë°±ì‹  ìš´ì†¡ìš© 2Â°C ~ 8Â°C ë²”ìœ„)
- **ë°ì´í„° ì €ì¥/ì „ì†¡**: 0.1ì´ˆ ê°„ê²©(ì´ˆë‹¹ 10íšŒ)ìœ¼ë¡œ ìˆ˜ì§‘Â·ì €ì¥, ì €ì¥ ì§í›„ MQTTë¡œ ì¦‰ì‹œ ì „ì†¡
- **ìë™ ë°ì´í„° ê´€ë¦¬**: 20ë¶„ ì´í›„ ë°ì´í„° ìë™ ì‚­ì œ

### âœ… ì›¹ ëŒ€ì‹œë³´ë“œ (Flask + Chart.js)
- **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: ì˜¨ë„ ê·¸ë˜í”„, GPS ìœ„ì¹˜, ìƒíƒœ í‘œì‹œ
- **ì—­ì§€ì˜¤ì½”ë”©**: ìœ„ë„/ê²½ë„ë¥¼ ì£¼ì†Œë¡œ ë³€í™˜ (BigDataCloud API)
- **ìƒíƒœ í‘œì‹œ**: ì¸í„°ë„· ì—°ê²°, ì˜¨ë„ ì„¼ì„œ ì—°ê²° ìƒíƒœ
- **ì˜¨ë„ ê²½ê³ **: ì ì • ë²”ìœ„(2~8Â°C)ë¥¼ ë²—ì–´ë‚˜ë©´ ì‹œê°ì  ê²½ê³ 
- **ëª¨ë‹ˆí„° ì¶œë ¥ ìµœì í™”**: 10.1ì¸ì¹˜ ë””ìŠ¤í”Œë ˆì´ì— ë§ì¶˜ UI

### âœ… ì˜¨ë„ ìƒíƒœ ëª¨ë‹ˆí„°ë§ (ë°±ì‹  ìš´ì†¡ìš©)
- **ì˜¨ë„ ë²”ìœ„**: 2Â°C ~ 8Â°C (ë°±ì‹  ì ì • ë³´ê´€ ì˜¨ë„)
- **ìƒíƒœ ë¶„ë¥˜**:
  - `critical_cold`: < 2.0Â°C (ìœ„í—˜í•œ ì¶”ìœ„)
  - `cold`: 2.0Â°C ~ 2.5Â°C (ì¶”ìœ„)
  - `normal`: 2.5Â°C ~ 7.5Â°C (ì •ìƒ)
  - `warm`: 7.5Â°C ~ 8.0Â°C (ë”°ëœ»í•¨)
  - `critical_hot`: > 8.0Â°C (ìœ„í—˜í•œ ë”ìœ„)

### âœ… ì„œë²„ ì „ì†¡ ì‹œìŠ¤í…œ (MQTT ì „ìš©)
- **ìë™ ì „ì†¡**: 0.1ì´ˆë§ˆë‹¤ 1ê°œ ë©”ì‹œì§€ ë°œí–‰(QoS 1)
- **ì¤‘ë³µ ë°©ì§€**: ë¡œì»¬ DBì— `sent` í”Œë˜ê·¸ë¡œ ì „ì†¡ ì™„ë£Œ ìƒíƒœ ì €ì¥
- **ëª¨ë‹ˆí„°ë§**: ë¡œê·¸ë¡œ ì „ì†¡ ì„±ê³µ/ì‹¤íŒ¨ í™•ì¸

---

## ì‹œìŠ¤í…œ êµ¬ì¡°

### ğŸ“ íŒŒì¼ êµ¬ì¡°

```
truck_gps/
â”œâ”€â”€ config.py              # ì„¤ì • íŒŒì¼ (MQTT, GPS, ì˜¨ë„ ì„¼ì„œ ë“±)
â”œâ”€â”€ database.py            # SQLite ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ í´ë˜ìŠ¤
â”œâ”€â”€ gps_tracker.py         # ë©”ì¸ í”„ë¡œê·¸ë¨ (ì‹¤í–‰ íŒŒì¼)
â”œâ”€â”€ gps_reader.py          # ì‹¤ì œ GPS í•˜ë“œì›¨ì–´ ì¸í„°í˜ì´ìŠ¤
â”œâ”€â”€ gps_simulator.py       # GPS ì‹œë®¬ë ˆì´í„° (í…ŒìŠ¤íŠ¸ìš©)
â”œâ”€â”€ temperature_reader.py  # ì‹¤ì œ ì˜¨ë„ ì„¼ì„œ ì¸í„°í˜ì´ìŠ¤ (MCP9600)
â”œâ”€â”€ temperature_simulator.py # ì˜¨ë„ ì‹œë®¬ë ˆì´í„°
â”œâ”€â”€ server_sender.py       # MQTT ì„œë²„ ì „ì†¡ í´ë˜ìŠ¤
â”œâ”€â”€ dashboard_server.py    # ì›¹ ëŒ€ì‹œë³´ë“œ Flask ì„œë²„
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html         # ëŒ€ì‹œë³´ë“œ HTML/JS/CSS
â”œâ”€â”€ requirements.txt       # Python íŒ¨í‚¤ì§€ ì˜ì¡´ì„±
â”œâ”€â”€ README.md              # ì´ ë¬¸ì„œ
â”œâ”€â”€ gps_tracker.log        # ë¡œê·¸ íŒŒì¼
â””â”€â”€ truck_gps.db           # SQLite ë°ì´í„°ë² ì´ìŠ¤
```

### ğŸ”„ ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           gps_tracker.py (ë©”ì¸ í”„ë¡œê·¸ë¨)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. setup()                                 â”‚    â”‚
â”‚  â”‚     - ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”                   â”‚    â”‚
â”‚  â”‚     - GPS ë¦¬ë” ì„ íƒ (ì‹¤ì œ/ì‹œë®¬ë ˆì´í„°)       â”‚    â”‚
â”‚  â”‚     - ì˜¨ë„ ë¦¬ë” ì´ˆê¸°í™”                      â”‚    â”‚
â”‚  â”‚     - MQTT ì „ì†¡ê¸° ì‹œì‘                      â”‚    â”‚
â”‚  â”‚                                             â”‚    â”‚
â”‚  â”‚  2. start() - ë©”ì¸ ë£¨í”„                     â”‚    â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚     â”‚  While running:                 â”‚    â”‚    â”‚
â”‚  â”‚     â”‚    â†’ GPS ë°ì´í„° ì½ê¸°            â”‚    â”‚    â”‚
â”‚  â”‚     â”‚    â†’ ì˜¨ë„ ë°ì´í„° ì½ê¸°           â”‚    â”‚    â”‚
â”‚  â”‚     â”‚    â†’ ìœ íš¨ì„± ê²€ì¦                â”‚    â”‚    â”‚
â”‚  â”‚     â”‚    â†’ DBì— ì €ì¥                  â”‚    â”‚    â”‚
â”‚  â”‚     â”‚    â†’ MQTTë¡œ ì „ì†¡                â”‚    â”‚    â”‚
â”‚  â”‚     â”‚    â†’ 20ë¶„ ì´ìƒ ë°ì´í„° ì‚­ì œ      â”‚    â”‚    â”‚
â”‚  â”‚     â”‚    â†’ ë¡œê·¸ ì¶œë ¥ (100ê°œë§ˆë‹¤)      â”‚    â”‚    â”‚
â”‚  â”‚     â”‚    â†’ íƒ€ì´ë° ì¡°ì • (0.1ì´ˆ ê°„ê²©)   â”‚    â”‚    â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                         â†“              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GPS      â”‚             â”‚ ì˜¨ë„     â”‚   â”‚ MQTT     â”‚
    â”‚ Reader   â”‚             â”‚ Reader   â”‚   â”‚ Broker   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                         â†“              â†‘
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
                  SQLite DB ì €ì¥
```

---

## ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­

### í•˜ë“œì›¨ì–´
- **ë¼ì¦ˆë² ë¦¬íŒŒì´**: 3, 4, Zero W ë“± ëª¨ë“  ëª¨ë¸
- **GPS ëª¨ë“ˆ** (ì„ íƒì‚¬í•­):
  - **USB GPS**: NK-GPS-U, NEO-6M, NEO-7M, BU-353S4
  - **UART GPS**: GPIO ì—°ê²° ê°€ëŠ¥ ëª¨ë“ˆ
- **ì˜¨ë„ ì„¼ì„œ** (ì„ íƒì‚¬í•­):
  - **MCP9600**: I2C ì—´ì „ëŒ€ ì¦í­ê¸° (ê¶Œì¥)
  - **DS18B20**: 1-Wire ì˜¨ë„ ì„¼ì„œ
  - **DHT22**: ì˜¨ìŠµë„ ì„¼ì„œ
- **ë©”ëª¨ë¦¬**: ìµœì†Œ 512MB RAM
- **ì €ì¥ ê³µê°„**: ì•½ 50-100MB (20ë¶„ ë°ì´í„°)

### ì†Œí”„íŠ¸ì›¨ì–´
- **Python**: 3.7 ì´ìƒ
- **OS**: ë¼ì¦ˆë² ë¦¬íŒŒì´ OS (Raspbian) ë˜ëŠ” ë‹¤ë¥¸ ë¦¬ëˆ…ìŠ¤ ë°°í¬íŒ

---

## ì„¤ì¹˜ ë°©ë²•

### 1ï¸âƒ£ ë¼ì¦ˆë² ë¦¬íŒŒì´ SSH ì ‘ì†

```bash
ssh ì‚¬ìš©ìëª…@ë¼ì¦ˆë² ë¦¬íŒŒì´IP
```

### 2ï¸âƒ£ ê°€ìƒí™˜ê²½ ìƒì„± ë° íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
cd ~/truck_gps

# ê°€ìƒí™˜ê²½ ìƒì„±
python3 -m venv gps_env

# ê°€ìƒí™˜ê²½ í™œì„±í™”
source gps_env/bin/activate

# íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r requirements.txt
```

**ë˜ëŠ” ì‹œìŠ¤í…œ ì „ì—­ ì„¤ì¹˜:**
```bash
pip3 install -r requirements.txt --break-system-packages
```

### 3ï¸âƒ£ GPS í¬íŠ¸ í™•ì¸ (ì‹¤ì œ GPS ì‚¬ìš© ì‹œ)

```bash
# ì—°ê²°ëœ í¬íŠ¸ í™•ì¸
ls /dev/ttyUSB* /dev/ttyACM* /dev/serial*

# í¬íŠ¸ ê¶Œí•œ ì„¤ì • (í•„ìš”ì‹œ)
sudo usermod -a -G dialout $USER
# ì¬ë¡œê·¸ì¸ í•„ìš”
```

### 4ï¸âƒ£ ì„¤ì • íŒŒì¼ ìˆ˜ì •

```bash
nano config.py
```

**ì£¼ìš” ì„¤ì •:**
```python
# GPS í¬íŠ¸
GPS_PORT = "/dev/ttyACM0"  # ì‹¤ì œ í¬íŠ¸ë¡œ ë³€ê²½

# MQTT ë¸Œë¡œì»¤ ì„¤ì •
MQTT_BROKER_HOST = "106.254.226.206"  # ë¸Œë¡œì»¤ IP
MQTT_BROKER_PORT = 1883
MQTT_TOPIC = "truck/gps_temp"

# ì°¨ëŸ‰ ID
VEHICLE_ID = "V001"

# ì˜¨ë„ ì„¼ì„œ íƒ€ì…
TEMP_SENSOR_TYPE = "MCP9600"  # MCP9600, DS18B20, DHT22, "SIMULATOR"
```

---

## ì‚¬ìš© ë°©ë²•

### â–¶ï¸ ê¸°ë³¸ ì‹¤í–‰

**GPS + ì˜¨ë„ ì¶”ì  ì‹œì‘:**
```bash
cd ~/truck_gps
source gps_env/bin/activate
python gps_tracker.py
```

**ì¶œë ¥ ì˜ˆì‹œ:**
```
2025-10-15 13:47:35 - INFO - GPS ì¶”ì  ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...
2025-10-15 13:47:35 - INFO - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ: truck_gps.db
2025-10-15 13:47:35 - INFO - MQTT ì „ì†¡ê¸° ì´ˆê¸°í™”: truck/gps_temp
2025-10-15 13:47:35 - INFO - GPS ë¦¬ë” ì´ˆê¸°í™” ì™„ë£Œ
2025-10-15 13:47:35 - INFO - ì˜¨ë„ ë¦¬ë” ì´ˆê¸°í™” ì™„ë£Œ (MCP9600)
2025-10-15 13:47:35 - INFO - GPS ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘ (ì´ˆë‹¹ 10ê°œ ìƒ˜í”Œ)
2025-10-15 13:47:45 - INFO - ìƒ˜í”Œ #100 | ì˜¨ë„: 5.2Â°C | ìƒíƒœ: normal
```

### â¹ï¸ ì¢…ë£Œ

```bash
# Ctrl+C ëˆ„ë¥´ê¸°
# ë˜ëŠ”
pkill -f gps_tracker.py
```

### ğŸ”„ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰

```bash
# ë°±ê·¸ë¼ìš´ë“œë¡œ ì‹¤í–‰
nohup python gps_tracker.py > output.log 2>&1 &

# í”„ë¡œì„¸ìŠ¤ í™•ì¸
ps aux | grep gps_tracker

# ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
tail -f gps_tracker.log
```

---

## ì›¹ ëŒ€ì‹œë³´ë“œ

### ğŸ–¥ï¸ ëŒ€ì‹œë³´ë“œ ì„œë²„ ì‹œì‘

**í„°ë¯¸ë„ 1 - GPS ì¶”ì :**
```bash
cd ~/truck_gps
source gps_env/bin/activate
python gps_tracker.py
```

**í„°ë¯¸ë„ 2 - ëŒ€ì‹œë³´ë“œ:**
```bash
cd ~/truck_gps
source gps_env/bin/activate
python dashboard_server.py
```

**ë¸Œë¼ìš°ì € ì ‘ì†:**
```
http://localhost:5000
# ë˜ëŠ”
http://ë¼ì¦ˆë² ë¦¬íŒŒì´IP:5000
```

### ğŸ“Š ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥

1. **ì‹¤ì‹œê°„ ì˜¨ë„ ê·¸ë˜í”„**
   - ìµœê·¼ 2ë¶„ ì˜¨ë„ íˆìŠ¤í† ë¦¬
   - 2Â°C, 8Â°C ì„ê³„ì„  í‘œì‹œ
   - í˜„ì¬ ì¸¡ì • ì˜¨ë„ í‘œì‹œ
   - ì˜¨ë„ ë²”ìœ„ì— ë”°ë¥¸ ìƒ‰ìƒ í‘œì‹œ

2. **í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ**
   - ìœ„ë„/ê²½ë„ ìˆ˜ì¹˜
   - ì—­ì§€ì˜¤ì½”ë”© ì£¼ì†Œ (ì˜ˆ: "ê´‘ì£¼ê´‘ì—­ì‹œ ë¶êµ¬")
   - ê°±ì‹  ì‹œê°„ í‘œì‹œ

3. **ìƒíƒœ í‘œì‹œ**
   - ì¸í„°ë„· ì—°ê²° ìƒíƒœ
   - ì˜¨ë„ ì„¼ì„œ ì—°ê²° ìƒíƒœ
   - ì˜¨ë„ ìƒíƒœ (ì ì •/ê²½ê³ /ìœ„í—˜)
   - ì €ì¥ëœ ë°ì´í„° ê°œìˆ˜

4. **ë””ë°”ì´ìŠ¤ ì •ë³´**
   - ì°¨ëŸ‰ ID
   - í˜„ì¬ ì‹œê°„
   - ì—°ê²° ìƒíƒœ

### âš™ï¸ ëŒ€ì‹œë³´ë“œ í¬íŠ¸ ë³€ê²½

```bash
# dashboard_server.py íŒŒì¼ ìˆ˜ì •
nano dashboard_server.py
```

```python
if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5001)  # 5001ë¡œ ë³€ê²½
```

---

## ì½”ë“œ êµ¬ì¡° ìƒì„¸ ì„¤ëª…

### 1ï¸âƒ£ `config.py` - ì„¤ì • ê´€ë¦¬

**ì—­í• :** ì‹œìŠ¤í…œ ì „ì²´ì˜ ì„¤ì •ì„ ì¤‘ì•™ ê´€ë¦¬

```python
# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
DB_PATH = "truck_gps.db"
RETENTION_SECONDS = 1200  # 20ë¶„

# GPS ì„¤ì •
GPS_PORT = "/dev/ttyACM0"
GPS_BAUDRATE = 9600

# ë°ì´í„° ìˆ˜ì§‘ ì„¤ì •
SAMPLE_RATE = 10  # ì´ˆë‹¹ 10ê°œ
INTERVAL = 1.0 / SAMPLE_RATE

# ì˜¨ë„ ì„¼ì„œ ì„¤ì •
TEMP_SENSOR_TYPE = "MCP9600"

# ì˜¨ë„ ìƒíƒœ ë²”ìœ„ ì„¤ì • (ë°±ì‹  ìš´ì†¡ ê¸°ì¤€)
TEMP_RANGES = {
    'critical_cold': (-float('inf'), 2.0),
    'cold': (2.0, 2.5),
    'normal': (2.5, 7.5),
    'warm': (7.5, 8.0),
    'critical_hot': (8.0, float('inf'))
}

# MQTT ë¸Œë¡œì»¤ ì„¤ì •
MQTT_BROKER_HOST = "106.254.226.206"
MQTT_BROKER_PORT = 1883
MQTT_TOPIC = "truck/gps_temp"
MQTT_CLIENT_ID = "truck_gps_client"
MQTT_QOS = 1

# ì°¨ëŸ‰ ì„¤ì •
VEHICLE_ID = "V001"

# ì „ì†¡ ì„¤ì •
SEND_INTERVAL = 0.1  # 0.1ì´ˆë§ˆë‹¤ ì „ì†¡
BATCH_SIZE = 1       # 1ê°œì”© ì „ì†¡
RETRY_ATTEMPTS = 3
RETRY_DELAY = 1

# ë¡œê¹… ì„¤ì •
LOG_LEVEL = "INFO"
LOG_FILE = "gps_tracker.log"
```

---

### 2ï¸âƒ£ `database.py` - ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬

**ì—­í• :** SQLite ë°ì´í„°ë² ì´ìŠ¤ CRUD ì‘ì—… ë° ìë™ ì •ë¦¬

```python
class GPSDatabase:
    def __init__(self, db_path=DB_PATH)
    def connect(self)
    def create_tables(self)
    def insert_gps_temperature_data(...)  # GPS + ì˜¨ë„ ì‚½ì…
    def get_latest_data(self, limit=10)   # ìµœê·¼ ë°ì´í„° ì¡°íšŒ
    def get_unsent_gps_temperature_data(limit)  # ë¯¸ì „ì†¡ ë°ì´í„° ì¡°íšŒ
    def mark_data_as_sent(data_ids)       # ì „ì†¡ ì™„ë£Œ í‘œì‹œ
    def purge_older_than_seconds(max_age_seconds)  # ì˜¤ë˜ëœ ë°ì´í„° ì‚­ì œ
    def close(self)
```

**í•µì‹¬ ë©”ì„œë“œ:**
- `insert_gps_temperature_data()`: GPS + ì˜¨ë„ ë°ì´í„° ì €ì¥
- `get_unsent_gps_temperature_data()`: ì „ì†¡ ì•ˆ ëœ ë°ì´í„°ë§Œ ì¡°íšŒ
- `purge_older_than_seconds()`: RETENTION_SECONDS ì´í›„ ë°ì´í„° ì‚­ì œ

---

### 3ï¸âƒ£ `gps_tracker.py` - ë©”ì¸ í”„ë¡œê·¸ë¨

**ì—­í• :** ì „ì²´ ì‹œìŠ¤í…œ í†µí•© ë° ì‹¤í–‰

```python
class GPSTracker:
    def __init__(self)
    def setup(self)              # ì´ˆê¸°í™”
    def start(self)              # ë©”ì¸ ë£¨í”„ ì‹œì‘
    def stop(self)               # ì¢…ë£Œ
    def signal_handler(...)      # Ctrl+C ì²˜ë¦¬
    
    # ì˜¨ë„ ìƒíƒœ íŒë‹¨
    def get_temperature_status(self, temperature)
```

**ë©”ì¸ ë£¨í”„ íë¦„:**
1. GPS ë°ì´í„° ì½ê¸°
2. ì˜¨ë„ ë°ì´í„° ì½ê¸°
3. ìœ íš¨ì„± ê²€ì¦
4. DBì— ì €ì¥
5. ë¡œê·¸ ì¶œë ¥ (100ê°œë§ˆë‹¤)
6. íƒ€ì´ë° ì¡°ì • (0.1ì´ˆ ê°„ê²©)
7. 20ë¶„ ì´ìƒ ë°ì´í„° ìë™ ì‚­ì œ

---

### 4ï¸âƒ£ `server_sender.py` - MQTT ì „ì†¡

**ì—­í• :** SQLite DBì—ì„œ ë¯¸ì „ì†¡ ë°ì´í„°ë¥¼ ì½ì–´ MQTTë¡œ ì „ì†¡

```python
class ServerSender:
    def __init__(self, db_path)
    def start(self)              # ì „ì†¡ ìŠ¤ë ˆë“œ ì‹œì‘
    def stop(self)
    def _get_unsent_data(limit)  # ë¯¸ì „ì†¡ ë°ì´í„° ì¡°íšŒ
    def _send_data(data)         # MQTT ì „ì†¡
    def _mark_data_as_sent(ids)  # ì „ì†¡ ì™„ë£Œ í‘œì‹œ
    def _get_temperature_status(temp)  # ì˜¨ë„ ìƒíƒœ íŒë‹¨
```

**ì „ì†¡ ë°ì´í„° í˜•ì‹:**
```json
{
  "vehicle_id": "V001",
  "timestamp": "2025-10-15T13:47:35.362449",
  "data": [
    {
      "id": 123,
      "vehicle_id": "V001",
      "timestamp": "2025-10-15T13:47:35.362449",
      "latitude": 37.5665,
      "longitude": 126.9780,
      "altitude": 45.2,
      "speed": 60.5,
      "heading": 180.0,
      "temperature": 5.2,
      "status": "normal"
    }
  ]
}
```

---

### 5ï¸âƒ£ `dashboard_server.py` - ì›¹ ëŒ€ì‹œë³´ë“œ

**ì—­í• :** Flask ê¸°ë°˜ ì›¹ ëŒ€ì‹œë³´ë“œ ì œê³µ

**API ì—”ë“œí¬ì¸íŠ¸:**
- `GET /`: ëŒ€ì‹œë³´ë“œ HTML
- `GET /api/latest`: ìµœì‹  GPS+ì˜¨ë„ ë°ì´í„° 1ê±´
- `GET /api/temperature-series`: ìµœê·¼ 20ë¶„ ì˜¨ë„ ì‹œë¦¬ì¦ˆ
- `GET /api/reverse-geocode`: ìœ„ë„/ê²½ë„ â†’ ì£¼ì†Œ ë³€í™˜
- `GET /api/health/internet`: ì¸í„°ë„· ì—°ê²° ìƒíƒœ
- `GET /api/health/temperature`: ì˜¨ë„ ì„¼ì„œ ì—°ê²° ìƒíƒœ

**ë°ì´í„° ì •ë¦¬:**
- `api_temperature_series`: RETENTION_SECONDS(20ë¶„) ê¸°ì¤€ ë°ì´í„°ë§Œ ì¡°íšŒ
- ì—­ì§€ì˜¤ì½”ë”© ìºì‹±: 3ìë¦¬ ìœ„ë„/ê²½ë„ë¡œ ìºì‹œí•˜ì—¬ API í˜¸ì¶œ ìµœì†Œí™”

---

### 6ï¸âƒ£ `temperature_reader.py` - ì˜¨ë„ ì„¼ì„œ

**ì—­í• :** ì‹¤ì œ ì˜¨ë„ ì„¼ì„œì—ì„œ ë°ì´í„° ì½ê¸°

**ì§€ì› ì„¼ì„œ:**
- **MCP9600**: I2C ì—´ì „ëŒ€ ì¦í­ê¸° (I2C ì£¼ì†Œ 0x67)
- **DS18B20**: 1-Wire ë””ì§€í„¸ ì˜¨ë„ ì„¼ì„œ
- **DHT22**: ì˜¨ìŠµë„ ì„¼ì„œ

```python
class TemperatureReader:
    def __init__(self, sensor_type='MCP9600')
    def connect(self)
    def read(self)  # ì˜¨ë„ ì½ê¸°
    def close()
    def get_temperature_status(temp)  # ìƒíƒœ íŒë‹¨
```

---

## ë°ì´í„°ë² ì´ìŠ¤

### ğŸ“Š í…Œì´ë¸” êµ¬ì¡°: `gps_temperature_data`

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|
| `id` | INTEGER | ìë™ ì¦ê°€ Primary Key | 1, 2, 3... |
| `vehicle_id` | TEXT | ì°¨ëŸ‰ ê³ ìœ  ì‹ë³„ì | "V001" |
| `timestamp` | REAL | Unix íƒ€ì„ìŠ¤íƒ¬í”„ | 1729004855.362 |
| `datetime` | TEXT | ë‚ ì§œ/ì‹œê°„ | "2025-10-15 13:47:35.362449" |
| `latitude` | REAL | ìœ„ë„ | 37.5665 |
| `longitude` | REAL | ê²½ë„ | 126.9780 |
| `altitude` | REAL | ê³ ë„ (ë¯¸í„°) | 45.2 |
| `speed` | REAL | ì†ë„ (km/h) | 60.5 |
| `heading` | REAL | ë°©í–¥ (ë„) | 180.0 |
| `temperature` | REAL | ì˜¨ë„ (Â°C) | 5.2 |
| `status` | TEXT | ì˜¨ë„ ìƒíƒœ | "normal" |
| `sent` | BOOLEAN | MQTT ì „ì†¡ ì™„ë£Œ ì—¬ë¶€ | TRUE/FALSE |
| `sent_at` | TIMESTAMP | ì „ì†¡ ì™„ë£Œ ì‹œê°„ | "2025-10-15 13:47:36" |
| `created_at` | TIMESTAMP | ë°ì´í„° ìƒì„± ì‹œê°„ | "2025-10-15 13:47:35" |

### ğŸ“ˆ ì„±ëŠ¥ ë° ìš©ëŸ‰

| í•­ëª© | ê°’ |
|------|------|
| ìƒ˜í”Œë§ìœ¨ | ì´ˆë‹¹ 10ê°œ |
| ë³´ê´€ ê¸°ê°„ | 20ë¶„ (RETENTION_SECONDS) |
| ìµœëŒ€ ë°ì´í„° ê°œìˆ˜ | ì•½ 12,000ê°œ |
| ë ˆì½”ë“œ í¬ê¸° | ì•½ 100-120 ë°”ì´íŠ¸ |
| DB í¬ê¸° | 1-2 MB |
| ìë™ ì‚­ì œ | 30ì´ˆë§ˆë‹¤ ì˜¤ë˜ëœ ë°ì´í„° ì •ë¦¬ |

### ğŸ” SQL ì¿¼ë¦¬ ì˜ˆì‹œ

```sql
-- ìµœê·¼ 10ê°œ ë°ì´í„°
SELECT datetime, latitude, longitude, temperature, status 
FROM gps_temperature_data 
ORDER BY timestamp DESC 
LIMIT 10;

-- ë¯¸ì „ì†¡ ë°ì´í„°
SELECT * FROM gps_temperature_data 
WHERE sent = FALSE OR sent IS NULL
ORDER BY timestamp DESC;

-- ì˜¨ë„ ë²”ìœ„ë³„ ë°ì´í„° ê°œìˆ˜
SELECT status, COUNT(*) as count 
FROM gps_temperature_data 
GROUP BY status;

-- í‰ê·  ì˜¨ë„
SELECT AVG(temperature) as avg_temp 
FROM gps_temperature_data 
WHERE temperature IS NOT NULL;
```

---

## ìë™ ì‹œì‘ ì„¤ì • (systemd)

ë¼ì¦ˆë² ë¦¬íŒŒì´ ë¶€íŒ… ì‹œ ìë™ìœ¼ë¡œ GPS ì¶”ì  ì‹œì‘:

### 1ï¸âƒ£ ì„œë¹„ìŠ¤ íŒŒì¼ ìƒì„±

```bash
sudo nano /etc/systemd/system/gps-tracker.service
```

### 2ï¸âƒ£ ë‚´ìš© ì…ë ¥

```ini
[Unit]
Description=Truck GPS Tracker
After=network.target

[Service]
Type=simple
User=infrac_vr_pc
WorkingDirectory=/home/infrax_vr_pc/truck_gps
ExecStart=/home/infrax_vr_pc/truck_gps/gps_env/bin/python /home/infrax_vr_pc/truck_gps/gps_tracker.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### 3ï¸âƒ£ ì„œë¹„ìŠ¤ í™œì„±í™”

```bash
sudo systemctl daemon-reload
sudo systemctl enable gps-tracker.service
sudo systemctl start gps-tracker.service
```

### 4ï¸âƒ£ ì„œë¹„ìŠ¤ ê´€ë¦¬ ëª…ë ¹

```bash
# ìƒíƒœ í™•ì¸
sudo systemctl status gps-tracker.service

# ì¤‘ì§€
sudo systemctl stop gps-tracker.service

# ì¬ì‹œì‘
sudo systemctl restart gps-tracker.service

# ë¡œê·¸ í™•ì¸
sudo journalctl -u gps-tracker.service -f
```

---

## ë¬¸ì œ í•´ê²°

### âŒ GPS ë°ì´í„°ë¥¼ ìˆ˜ì‹ í•˜ì§€ ëª»í•¨

**ì¦ìƒ:** GPS ë¦¬ë” ì—°ê²° ì‹¤íŒ¨

**í•´ê²°ì±…:**
```bash
# GPS í¬íŠ¸ í™•ì¸
lsusb
ls -l /dev/ttyUSB* /dev/ttyACM*

# í¬íŠ¸ ê¶Œí•œ ì„¤ì •
sudo usermod -a -G dialout $USER
# ì¬ë¡œê·¸ì¸ í•„ìš”
```

---

### âŒ I2C ì˜¨ë„ ì„¼ì„œ ì—°ê²° ì‹¤íŒ¨ (MCP9600)

**ì¦ìƒ:** "I2C device not found"

**í•´ê²°ì±…:**
```bash
# I2C í™œì„±í™”
sudo raspi-config
# Interface Options â†’ I2C â†’ Enable

# I2C ì¥ì¹˜ ìŠ¤ìº”
sudo i2cdetect -y 1
# MCP9600 ì£¼ì†Œ: 0x67

# i2c-tools ì„¤ì¹˜
sudo apt-get install i2c-tools
```

---

### âŒ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì˜¤ë¥˜ (externally-managed-environment)

**ì¦ìƒ:** `pip install` ì‹¤íŒ¨

**í•´ê²°ì±…:**
```bash
# ê°€ìƒí™˜ê²½ ì‚¬ìš© (ê¶Œì¥)
python3 -m venv gps_env
source gps_env/bin/activate
pip install -r requirements.txt

# ë˜ëŠ” ì‹œìŠ¤í…œ ì „ì—­ ì„¤ì¹˜
pip3 install -r requirements.txt --break-system-packages
```

---

### âŒ ëŒ€ì‹œë³´ë“œ ì ‘ì† ë¶ˆê°€

**ì¦ìƒ:** Connection refused

**í•´ê²°ì±…:**
```bash
# ëŒ€ì‹œë³´ë“œ í”„ë¡œì„¸ìŠ¤ í™•ì¸
ps aux | grep dashboard_server

# í¬íŠ¸ í™•ì¸
netstat -an | grep 5000

# ëŒ€ì‹œë³´ë“œ ì¬ì‹œì‘
pkill -f dashboard_server
python dashboard_server.py
```

---

### âŒ í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ ì•ˆ ë¨

**ì¦ìƒ:** "ì¡°íšŒì¤‘..."ì´ ê³„ì† í‘œì‹œ

**í•´ê²°ì±…:**
- ì¸í„°ë„· ì—°ê²° í™•ì¸
- ë°©í™”ë²½ í™•ì¸ (BigDataCloud API ì ‘ê·¼ ê°€ëŠ¥ ì—¬ë¶€)
- `dashboard_server.py` ë¡œê·¸ í™•ì¸

---

### âŒ ë°ì´í„°ë² ì´ìŠ¤ ì‹œê°„ì´ 9ë¶„ ëŠë¦¼

**ì¦ìƒ:** DB ì €ì¥ ì‹œê°„ì´ ì‹¤ì œ ì‹œê°„ë³´ë‹¤ ëŠë¦¼

**í•´ê²°ì±…:**
- `database.py`ì—ì„œ `zoneinfo.ZoneInfo('Asia/Seoul')` ì‚¬ìš©
- ë¼ì¦ˆë² ë¦¬íŒŒì´ ì‹œê°„ëŒ€ ì„¤ì •:
```bash
sudo timedatectl set-timezone Asia/Seoul
```

---

## ë¦¬íŒ©í† ë§ ì´ë ¥

### âœ… ì™„ë£Œëœ ë¦¬íŒ©í† ë§

1. **ì˜¨ë„ ë²”ìœ„ ì¤‘ì•™í™”**
   - ì´ì „: 4ê°œ íŒŒì¼ì—ì„œ í•˜ë“œì½”ë”©
   - í˜„ì¬: `config.py`ì˜ `TEMP_RANGES` ì‚¬ìš©

2. **MQTT ì„¤ì • ì¤‘ì•™í™”**
   - ì´ì „: `server_sender.py`ì—ì„œ í•˜ë“œì½”ë”©
   - í˜„ì¬: `config.py`ì—ì„œ ê´€ë¦¬

3. **ì°¨ëŸ‰ ID ì¤‘ì•™í™”**
   - ì´ì „: ì—¬ëŸ¬ íŒŒì¼ì—ì„œ í•˜ë“œì½”ë”©
   - í˜„ì¬: `config.py`ì˜ `VEHICLE_ID` ì‚¬ìš©

4. **SQL ì¸ì ì…˜ ë°©ì§€**
   - ì´ì „: ë¬¸ìì—´ ë³‘í•©
   - í˜„ì¬: f-string ì‚¬ìš© (DDLì€ í—ˆìš©ë¨)

---

## ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” êµìœ¡ ë° ì—°êµ¬ ëª©ì ìœ¼ë¡œ ììœ ë¡­ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ê¸°ì—¬ ë° ë¬¸ì˜

ë¬¸ì œë‚˜ ê°œì„  ì‚¬í•­ì´ ìˆìœ¼ë©´ ì´ìŠˆë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.

**ì œì‘:** ë°±ì‹  ìš´ì†¡ ì°¨ëŸ‰ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ v2.0  
**ë‚ ì§œ:** 2025-10-15  
**í”Œë«í¼:** ë¼ì¦ˆë² ë¦¬íŒŒì´ + Python 3
